<div class="dashboard-container">
  <header class="dashboard-header">
    <div>
      <h1>Dashboard</h1>
      <p class="header-subtitle">AWS environment overview</p>
    </div>
    <div class="header-actions">
      <span class="last-updated">Updated {{ getFormattedDate(dashboardData?.summary?.lastUpdated) }}</span>
      <button class="btn-refresh" (click)="refreshData()" [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i>
        Refresh
      </button>
    </div>
  </header>

  <section class="summary-grid">
    <a
      class="summary-card"
      *ngFor="let tile of summaryTiles"
      [routerLink]="tile.route"
      [attr.aria-label]="tile.ariaLabel || tile.label">
      <span class="summary-value">{{ tile.value }}</span>
      <span class="summary-label">{{ tile.label }}</span>
    </a>
  </section>

  <section class="section-card" *ngIf="resourceHealthCards.length">
    <header class="section-header">
      <h2>Resource Health</h2>
      <span class="section-subtitle">Current status of core services</span>
    </header>
    <div class="health-grid">
      <article class="health-card" *ngFor="let health of resourceHealthCards">
        <header class="health-head">
          <div>
            <h3>{{ health.title }}</h3>
            <span class="health-total">Total {{ health.badge }}</span>
          </div>
        </header>
        <div class="health-bar">
          <ng-container *ngFor="let segment of health.segments">
            <div class="health-segment" [ngClass]="segment.color" [style.width.%]="getPercentage(segment.value, health.total)"
                 *ngIf="segment.value">
            </div>
          </ng-container>
        </div>
        <footer class="health-foot">
          <span class="health-status">{{ health.status }}</span>
          <span class="health-description">{{ health.description }}</span>
        </footer>
      </article>
    </div>
  </section>

  <section class="monitoring-grid">
    <article class="monitor-card">
      <header>
        <h3>Resource Monitoring (CloudWatch)</h3>
      </header>
      <div class="monitor-row" *ngFor="let metric of monitoringMetrics">
        <div class="monitor-info">
          <span class="monitor-label">{{ metric.label }}</span>
          <span class="monitor-value">{{ metric.value }}%</span>
        </div>
        <div class="monitor-bar">
          <div class="monitor-fill" [style.width.%]="metric.value"></div>
        </div>
        <p class="monitor-description">{{ metric.description }}</p>
      </div>
    </article>

    <article class="monitor-card">
      <header>
        <h3>Instance Status</h3>
      </header>
      <div class="instance-status">
        <div class="status-metric">
          <span class="status-label">Total</span>
          <span class="status-value">{{ formatNumber(ec2InstanceStatus.total) }}</span>
        </div>
        <div class="status-metric">
          <span class="status-label">Running</span>
          <span class="status-value running">{{ formatNumber(ec2InstanceStatus.running) }}</span>
        </div>
        <div class="status-metric">
          <span class="status-label">Stopped</span>
          <span class="status-value stopped">{{ formatNumber(ec2InstanceStatus.stopped) }}</span>
        </div>
      </div>
      <div class="monitor-bar compact">
        <div class="monitor-fill success" [style.width.%]="ec2InstanceStatus.runningPercent"></div>
      </div>
      <p class="monitor-description">{{ ec2InstanceStatus.runningPercent }}% of instances running</p>
    </article>

    <article class="monitor-card">
      <header>
        <h3>SSM Agent Status</h3>
      </header>
      <div class="monitor-row single">
        <div class="monitor-info">
          <span class="monitor-label">SSM Agent</span>
          <span class="monitor-value">{{ ssmCoverage }}%</span>
        </div>
        <div class="monitor-bar">
          <div class="monitor-fill success" [style.width.%]="ssmCoverage"></div>
        </div>
        <p class="monitor-description">Instances with SSM Agent connected</p>
      </div>
    </article>
  </section>

  <section class="metric-summary-grid" *ngIf="dashboardData as data">
    <article class="metric-summary-card">
      <header class="metric-summary-header">
        <div>
          <h3>Resources by Account</h3>
          <span class="metric-summary-subtitle">{{ formatNumber(getAccountTotal()) }} total resources</span>
        </div>
      </header>

      <ng-container *ngIf="data.accountDistribution as accounts; else emptyAccounts">
        <div class="metric-summary-list">
          <div class="metric-summary-item" *ngFor="let account of accounts">
            <div class="metric-summary-item-head">
              <span class="metric-summary-label">{{ account.accountName }}</span>
              <span class="metric-summary-value">{{ formatNumber(account.count) }}</span>
            </div>
            <div class="metric-summary-bar">
              <div class="metric-summary-bar-fill" [style.width.%]="getBarWidth(account.count, accountMaxCount)"></div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyAccounts>
        <p class="metric-summary-empty">No account distribution data available</p>
      </ng-template>
    </article>

    <article class="metric-summary-card">
      <header class="metric-summary-header">
        <div>
          <h3>Resources by Region</h3>
          <span class="metric-summary-subtitle">{{ data.summary.totalRegions || 0 }} regions tracked</span>
        </div>
      </header>

      <ng-container *ngIf="getTopRegions() as regions; else emptyRegions">
        <div class="metric-summary-list">
          <div class="metric-summary-item" *ngFor="let region of regions">
            <div class="metric-summary-item-head">
              <span class="metric-summary-label">{{ region.region }}</span>
              <span class="metric-summary-value">{{ formatNumber(region.count) }}</span>
            </div>
            <div class="metric-summary-bar">
              <div class="metric-summary-bar-fill" [style.width.%]="getBarWidth(region.count, regionMaxCount)"></div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyRegions>
        <p class="metric-summary-empty">No region distribution data available</p>
      </ng-template>
    </article>

    <article class="metric-summary-card">
      <header class="metric-summary-header">
        <div>
          <h3>Resources by Type</h3>
          <span class="metric-summary-subtitle">{{ formatNumber(data.summary.totalResources || 0) }} total resources</span>
        </div>
      </header>

      <ng-container *ngIf="resourceTypes.length; else emptyResourceTypes">
        <div class="metric-summary-list">
          <div class="metric-summary-item" *ngFor="let resource of resourceTypes">
            <div class="metric-summary-item-head">
              <span class="metric-summary-label">{{ getResourceDisplayName(resource.name) }}</span>
              <span class="metric-summary-value">{{ formatNumber(resource.count) }}</span>
            </div>
            <div class="metric-summary-bar">
              <div class="metric-summary-bar-fill" [style.width.%]="getBarWidth(resource.count, resourceTypeMaxCount)"></div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyResourceTypes>
        <p class="metric-summary-empty">No resource count data available</p>
      </ng-template>
    </article>
  </section>

  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading metrics data...</p>
  </div>
</div>
