<!-- src/app/features/dashboard/dashboard.component.html -->
<div class="ov-dashboard">
  <!-- Header -->
  <div class="ov-dashboard-header">
    <div class="ov-header-title">
      <h1>Dashboard</h1>
      <span class="ov-last-update" *ngIf="!loading && currentMetric">
        Last updated: {{ getCurrentTime() }}
      </span>
    </div>
    <div class="ov-header-actions">
      <button (click)="refreshData()" class="ov-btn ov-btn-icon" [disabled]="loading">
        <span class="ov-icon">↻</span>
        <span>Refresh</span>
      </button>
      <button (click)="onTriggerCollector()" class="ov-btn ov-btn-primary" [disabled]="loading">
        <span class="ov-icon">⚡</span>
        <span>Trigger Collector</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="ov-loading-container">
    <div class="ov-spinner"></div>
    <p>Loading metrics...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="ov-error-container">
    <div class="ov-error-icon">⚠️</div>
    <h3>Error Loading Metrics</h3>
    <p>{{ error }}</p>
    <button (click)="refreshData()" class="ov-btn ov-btn-primary">Retry</button>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!loading && !error && currentMetric" class="ov-dashboard-content">
    
    <!-- Top Metrics Cards Grid -->
    <div class="ov-metrics-grid">
      <!-- Total Resources - Central Card -->
      <div class="ov-metric-card-large" *ngIf="hasValue(currentMetric.totalResources)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.totalResources) }}</div>
        <div class="ov-card-label">TOTAL RESOURCES</div>
      </div>

      <!-- EC2 Instances -->
      <a class="ov-metric-card" routerLink="/ec2" *ngIf="hasValue(currentMetric.resourceCounts_EC2Instance)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.resourceCounts_EC2Instance) }}</div>
        <div class="ov-card-label">EC2 INSTANCES</div>
      </a>

      <!-- RDS Instances -->
      <a class="ov-metric-card" routerLink="/rds" *ngIf="hasValue(currentMetric.resourceCounts_RDSInstance)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.resourceCounts_RDSInstance) }}</div>
        <div class="ov-card-label">RDS INSTANCES</div>
      </a>

      <!-- S3 Buckets -->
      <a class="ov-metric-card" routerLink="/s3" *ngIf="hasValue(currentMetric.resourceCounts_S3Bucket)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.resourceCounts_S3Bucket) }}</div>
        <div class="ov-card-label">S3 BUCKETS</div>
      </a>

      <!-- EBS Volumes -->
      <a class="ov-metric-card" routerLink="/ebs" *ngIf="hasValue(currentMetric.resourceCounts_EBSVolume)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.resourceCounts_EBSVolume) }}</div>
        <div class="ov-card-label">EBS VOLUMES</div>
      </a>

      <!-- EBS Snapshots -->
      <a class="ov-metric-card" routerLink="/ebs-snapshots" *ngIf="hasValue(currentMetric.resourceCounts_EBSSnapshot)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.resourceCounts_EBSSnapshot) }}</div>
        <div class="ov-card-label">EBS SNAPSHOTS</div>
      </a>

      <!-- AMI Snapshots -->
      <a class="ov-metric-card" routerLink="/ami-snapshots" *ngIf="hasValue(currentMetric.amiSnapshots)">
        <div class="ov-card-value">{{ formatNumber(currentMetric.amiSnapshots) }}</div>
        <div class="ov-card-label">AMI SNAPSHOTS</div>
      </a>
    </div>

    <!-- Resource Health Section -->
    <section class="ov-section">
      <h2 class="ov-section-title">Resource Health</h2>
      
      <div class="ov-health-grid">
        <!-- EC2 Instances Health Card -->
        <div class="ov-health-card" *ngIf="hasEC2Data()">
          <div class="ov-health-header">
            <span class="ov-health-title">EC2 Instances</span>
            <span class="ov-health-badge">{{ currentMetric.resourceCounts_EC2Instance }}</span>
          </div>
          
          <div class="ov-progress-bar">
            <div class="ov-progress-segment ov-segment-running" 
                 [style.width.%]="getEC2RunningPercentage()">
            </div>
            <div class="ov-progress-segment ov-segment-stopped" 
                 [style.width.%]="getEC2StoppedPercentage()">
            </div>
          </div>
          
          <div class="ov-progress-labels">
            <span class="ov-label-running">{{ currentMetric.byState_running }}</span>
            <span class="ov-label-stopped">{{ currentMetric.byState_stopped }}</span>
          </div>
          
          <div class="ov-health-status" [ngClass]="getEC2HealthClass()">
            {{ getEC2HealthText() }}
            <span class="ov-status-detail" *ngIf="currentMetric && currentMetric.byState_stopped && currentMetric.byState_stopped > 0">
              ({{ currentMetric.byState_stopped }} stopped)
            </span>
          </div>
          
          <div class="ov-health-details" *ngIf="hasEC2HealthDetails()">
            <span>Healthy: {{ currentMetric.healthStatus_Healthy }}</span>
            <span>Stopped: {{ currentMetric.healthStatus_Stopped }}</span>
            <span>SSM Connected: {{ currentMetric.ssmAgent_connected }}</span>
          </div>
        </div>

        <!-- RDS Instances Health Card -->
        <div class="ov-health-card" *ngIf="hasRDSData()">
          <div class="ov-health-header">
            <span class="ov-health-title">RDS Instances</span>
            <span class="ov-health-badge">{{ currentMetric.total }}</span>
          </div>
          
          <div class="ov-progress-bar">
            <div class="ov-progress-segment ov-segment-running" 
                 [style.width.%]="getRDSHealthPercentage()">
            </div>
          </div>
          
          <div class="ov-progress-labels">
            <span class="ov-label-running">{{ currentMetric.available }}</span>
          </div>
          
          <div class="ov-health-status ov-status-healthy">
            {{ getRDSHealthPercentage() }}% Healthy
          </div>
        </div>

        <!-- EBS Volumes Health Card -->
        <div class="ov-health-card" *ngIf="hasValue(currentMetric.resourceCounts_EBSVolume)">
          <div class="ov-health-header">
            <span class="ov-health-title">EBS Volumes</span>
            <span class="ov-health-badge">{{ currentMetric.resourceCounts_EBSVolume }}</span>
          </div>
          
          <div class="ov-progress-bar">
            <div class="ov-progress-segment ov-segment-running" style="width: 100%"></div>
          </div>
          
          <div class="ov-progress-labels">
            <span class="ov-label-running">{{ currentMetric.resourceCounts_EBSVolume }}</span>
          </div>
          
          <div class="ov-health-status ov-status-healthy">
            100% Healthy
          </div>
        </div>

        <!-- S3 Buckets Health Card -->
        <div class="ov-health-card" *ngIf="hasValue(currentMetric.resourceCounts_S3Bucket)">
          <div class="ov-health-header">
            <span class="ov-health-title">S3 Buckets</span>
            <span class="ov-health-badge">{{ currentMetric.resourceCounts_S3Bucket }}</span>
          </div>
          
          <div class="ov-progress-bar">
            <div class="ov-progress-segment ov-segment-running" style="width: 100%"></div>
          </div>
          
          <div class="ov-progress-labels">
            <span class="ov-label-running">{{ currentMetric.resourceCounts_S3Bucket }}</span>
          </div>
          
          <div class="ov-health-status ov-status-healthy">
            100% Healthy
          </div>
        </div>
      </div>
    </section>

    <!-- Monitoring Section -->
    <section class="ov-monitoring-section">
      <div class="ov-monitoring-grid">
        
        <!-- CloudWatch Monitoring Card -->
        <div class="ov-monitoring-card">
          <h3>Resource Monitoring (CloudWatch)</h3>
          
          <!-- RAM Monitoring -->
          <div class="ov-monitor-item" *ngIf="hasValue(currentMetric.cloudwatchAgent_percentageWithMemory)">
            <div class="ov-monitor-label">RAM Monitoring</div>
            <div class="ov-monitor-bar">
              <div class="ov-monitor-fill ov-fill-cyan" 
                   [style.width.%]="currentMetric.cloudwatchAgent_percentageWithMemory">
              </div>
            </div>
            <div class="ov-monitor-value">
              {{ currentMetric.cloudwatchAgent_percentageWithMemory }}%
              <span>Active Monitoring on Resources</span>
            </div>
          </div>

          <!-- Disk Monitoring -->
          <div class="ov-monitor-item" *ngIf="hasValue(currentMetric.cloudwatchAgent_percentageWithDisk)">
            <div class="ov-monitor-label">Disk Monitoring</div>
            <div class="ov-monitor-bar">
              <div class="ov-monitor-fill ov-fill-purple" 
                   [style.width.%]="currentMetric.cloudwatchAgent_percentageWithDisk">
              </div>
            </div>
            <div class="ov-monitor-value">
              {{ currentMetric.cloudwatchAgent_percentageWithDisk }}%
              <span>Active Monitoring on Resources</span>
            </div>
          </div>
        </div>

        <!-- Instance Status Card -->
        <div class="ov-status-card">
          <h3>Instance Status</h3>
          <div class="ov-status-header">
            <span>EC2 Status</span>
            <span class="ov-status-badge" *ngIf="hasEC2Data()">
              {{ getEC2RunningPercentage() }}% RUNNING
            </span>
          </div>
          <div class="ov-status-subtitle">Overview of instance states</div>
          
          <div class="ov-status-grid">
            <div class="ov-stat">
              <div class="ov-stat-label">TOTAL</div>
              <div class="ov-stat-value">{{ currentMetric.resourceCounts_EC2Instance || 0 }}</div>
            </div>
            <div class="ov-stat">
              <div class="ov-stat-label">RUNNING</div>
              <div class="ov-stat-value ov-text-green">{{ currentMetric.byState_running || 0 }}</div>
            </div>
            <div class="ov-stat">
              <div class="ov-stat-label">STOPPED</div>
              <div class="ov-stat-value ov-text-gray">{{ currentMetric.byState_stopped || 0 }}</div>
            </div>
          </div>
        </div>

        <!-- SSM Agent Status Card -->
        <div class="ov-agent-card">
          <h3>SSM Agent Status</h3>
          <div class="ov-agent-label">SSM Agent</div>
          
          <div class="ov-agent-bar" *ngIf="hasValue(currentMetric.ssmAgent_percentageConnected)">
            <div class="ov-agent-fill" 
                 [style.width.%]="currentMetric.ssmAgent_percentageConnected">
            </div>
          </div>
          
          <div class="ov-agent-value">
            {{ currentMetric.ssmAgent_percentageConnected || 0 }}%
            <span>Instances with SSM Agent Connected</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && !currentMetric" class="ov-empty-state">
    <div class="ov-empty-icon">📊</div>
    <h3>No metrics available</h3>
    <p>Click "Trigger Collector" to start collecting AWS metrics.</p>
    <button (click)="onTriggerCollector()" class="ov-btn ov-btn-primary">
      <span class="ov-icon">⚡</span>
      Trigger Collector
    </button>
  </div>
</div>