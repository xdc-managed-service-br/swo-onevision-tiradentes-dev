<!-- src/app/features/dashboard/dashboard.component.html -->
<div class="dashboard">
  <div class="dashboard-header">
    <h2>Metrics Dashboard</h2>
    <div class="dashboard-controls">
      <button (click)="refreshData()" class="btn-refresh">üîÑ Refresh</button>
      <button (click)="onTriggerCollector()" class="btn-trigger">
        ‚ö° Trigger Collector
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="ov-loading">
    <div class="ov-loading-spinner"></div>
    <p>Loading metrics...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="ov-error">
    <div class="ov-error-icon">‚ö†Ô∏è</div>
    <h3>Error Loading Metrics</h3>
    <p>{{ error }}</p>
    <button (click)="refreshData()" class="btn-retry">Retry</button>
  </div>
  <!-- Main Content -->
  <div *ngIf="!loading && metrics?.length" class="metrics-container">
    
    <!-- Date Selector for Historical Data -->
    <div class="date-selector">
      <label for="dateSelect">View Historical Data:</label>
      <input 
        type="date" 
        id="dateSelect"
        [formControl]="selectedDate"
        class="date-input"
      />
    </div>

    <!-- Metrics Cards -->
    <div *ngFor="let metric of metrics" class="metric-card" [ngClass]="getMetricTypeClass(metric.id)">

      <div class="metric-content">

        <!-- Summary Section -->
        <div class="metric-section" *ngIf="hasValue(metric.totalResources) || hasValue(metric.resourceRegionsFound)">
          <h4>Summary</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.totalResources)">
              <span class="label">Total Resources:</span>
              <span class="value highlight">{{ formatValue(metric.totalResources) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceRegionsFound)">
              <span class="label">Regions Found:</span>
              <span class="value">{{ formatValue(metric.resourceRegionsFound) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.regionsCollected)">
              <span class="label">Regions Collected:</span>
              <span class="value">{{ formatValue(metric.regionsCollected) }}</span>
            </div>
          </div>
        </div>

        <!-- EC2 Health Section -->
        <div class="metric-section" *ngIf="hasValue(metric.byState_running) || hasValue(metric.byState_stopped)">
          <h4>EC2 Health</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.byState_running)">
              <span class="label">Running:</span>
              <span class="value status-running">{{ formatValue(metric.byState_running) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.byState_stopped)">
              <span class="label">Stopped:</span>
              <span class="value status-stopped">{{ formatValue(metric.byState_stopped) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.healthStatus_Healthy)">
              <span class="label">Healthy:</span>
              <span class="value status-healthy">{{ formatValue(metric.healthStatus_Healthy) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.healthStatus_Stopped)">
              <span class="label">Unhealthy:</span>
              <span class="value status-unhealthy">{{ formatValue(metric.healthStatus_Stopped) }}</span>
            </div>
          </div>
        </div>

        <!-- CloudWatch Agent Section -->
        <div class="metric-section" *ngIf="hasValue(metric.cloudwatchAgent_memoryMonitoring) || hasValue(metric.cloudwatchAgent_diskMonitoring)">
          <h4>CloudWatch Agent</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_bothEnabled)">
              <span class="label">Both Enabled:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_bothEnabled) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_diskMonitoring)">
              <span class="label">Disk Monitoring:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_diskMonitoring) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_memoryMonitoring)">
              <span class="label">Memory Monitoring:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_memoryMonitoring) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_noneEnabled)">
              <span class="label">None Enabled:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_noneEnabled) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_percentageWithDisk)">
              <span class="label">% with Disk:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_percentageWithDisk) }}%</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.cloudwatchAgent_percentageWithMemory)">
              <span class="label">% with Memory:</span>
              <span class="value">{{ formatValue(metric.cloudwatchAgent_percentageWithMemory) }}%</span>
            </div>
          </div>
        </div>

        <!-- SSM Agent Section -->
        <div class="metric-section" *ngIf="hasValue(metric.ssmAgent_connected) || hasValue(metric.ssmAgent_notConnected)">
          <h4>SSM Agent</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.ssmAgent_connected)">
              <span class="label">Connected:</span>
              <span class="value status-connected">{{ formatValue(metric.ssmAgent_connected) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.ssmAgent_notConnected)">
              <span class="label">Not Connected:</span>
              <span class="value status-disconnected">{{ formatValue(metric.ssmAgent_notConnected) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.ssmAgent_notInstalled)">
              <span class="label">Not Installed:</span>
              <span class="value">{{ formatValue(metric.ssmAgent_notInstalled) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.ssmAgent_percentageConnected)">
              <span class="label">% Connected:</span>
              <span class="value">{{ formatValue(metric.ssmAgent_percentageConnected) }}%</span>
            </div>
          </div>
        </div>

        <!-- Cost Optimization Section -->
        <div class="metric-section" *ngIf="hasValue(metric.potentialMonthlySavings)">
          <h4>Cost Optimization</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.potentialMonthlySavings)">
              <span class="label">Potential Monthly Savings:</span>
              <span class="value highlight-cost">${{ formatValue(metric.potentialMonthlySavings) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.unassociatedElasticIPs)">
              <span class="label">Unassociated EIPs:</span>
              <span class="value">{{ formatValue(metric.unassociatedElasticIPs) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.unattachedEBSVolumes)">
              <span class="label">Unattached EBS Volumes:</span>
              <span class="value">{{ formatValue(metric.unattachedEBSVolumes) }}</span>
            </div>
          </div>
        </div>

        <!-- Security Section -->
        <div class="metric-section" *ngIf="hasValue(metric.exposedSecurityGroups)">
          <h4>Security</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.exposedSecurityGroups)">
              <span class="label">Exposed Security Groups:</span>
              <span class="value status-warning">{{ formatValue(metric.exposedSecurityGroups) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.percentageExposed)">
              <span class="label">% Exposed:</span>
              <span class="value">{{ formatValue(metric.percentageExposed) }}%</span>
            </div>
          </div>
        </div>

        <!-- RDS Section -->
        <div class="metric-section" *ngIf="hasValue(metric.total) && metric.id?.includes('RDS')">
          <h4>RDS Metrics</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.total)">
              <span class="label">Total Instances:</span>
              <span class="value">{{ formatValue(metric.total) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.available)">
              <span class="label">Available:</span>
              <span class="value">{{ formatValue(metric.available) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.multiAZ)">
              <span class="label">Multi-AZ:</span>
              <span class="value">{{ formatValue(metric.multiAZ) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.performanceInsights)">
              <span class="label">Performance Insights:</span>
              <span class="value">{{ formatValue(metric.performanceInsights) }}</span>
            </div>
          </div>
        </div>

        <!-- Storage Section -->
        <div class="metric-section" *ngIf="hasValue(metric.amiSnapshots) || hasValue(metric.ebsSnapshots)">
          <h4>Storage Metrics</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.amiSnapshots)">
              <span class="label">AMI Snapshots:</span>
              <span class="value">{{ formatValue(metric.amiSnapshots) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.ebsSnapshots)">
              <span class="label">EBS Snapshots:</span>
              <span class="value">{{ formatValue(metric.ebsSnapshots) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.ebsVolumes)">
              <span class="label">EBS Volumes:</span>
              <span class="value">{{ formatValue(metric.ebsVolumes) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.s3Buckets)">
              <span class="label">S3 Buckets:</span>
              <span class="value">{{ formatValue(metric.s3Buckets) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.s3WithLifecycle)">
              <span class="label">S3 with Lifecycle:</span>
              <span class="value">{{ formatValue(metric.s3WithLifecycle) }}</span>
            </div>
          </div>
        </div>

        <!-- Resource Counts Section -->
        <div class="metric-section">
          <h4>Resource Counts</h4>
          <div class="metric-grid">
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_EC2Instance)">
              <span class="label">EC2 Instances:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_EC2Instance) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_S3Bucket)">
              <span class="label">S3 Buckets:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_S3Bucket) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_VPC)">
              <span class="label">VPCs:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_VPC) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_SecurityGroup)">
              <span class="label">Security Groups:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_SecurityGroup) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_RDSInstance)">
              <span class="label">RDS Instances:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_RDSInstance) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_LoadBalancer)">
              <span class="label">Load Balancers:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_LoadBalancer) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_EBSVolume)">
              <span class="label">EBS Volumes:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_EBSVolume) }}</span>
            </div>
            <div class="metric-item" *ngIf="hasValue(metric.resourceCounts_EBSSnapshot)">
              <span class="label">EBS Snapshots:</span>
              <span class="value">{{ formatValue(metric.resourceCounts_EBSSnapshot) }}</span>
            </div>
            <!-- Add more resource counts as needed -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && metrics?.length === 0" class="empty-state">
    <h3>No metrics available</h3>
    <p>Click "Trigger Collector" to start collecting AWS metrics.</p>
  </div>
</div>