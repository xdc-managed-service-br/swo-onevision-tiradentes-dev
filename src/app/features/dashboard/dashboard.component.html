<article class="ov-container" aria-labelledby="dashboard-title">
  <h1 id="dashboard-title" class="ov-title">Dashboard</h1>

  <!-- Loading -->
  <div *ngIf="loading" class="ov-loading">Loading dashboard dataâ€¦</div>

  <!-- ConteÃºdo -->
  <div *ngIf="!loading" class="db-grid">

    <!-- 1) Cards de resumo -->
    <section class="db-stats" aria-label="Resource summary">
      <a class="db-stat is-total" [routerLink]="['/resources']" [attr.aria-label]="'Total resources: ' + resourceCounts.total">
        <span class="db-stat__value">{{ resourceCounts.total }}</span>
        <span class="db-stat__label">Total Resources</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/ec2']" [attr.aria-label]="'EC2 Instances: ' + resourceCounts.ec2">
        <span class="db-stat__value">{{ resourceCounts.ec2 }}</span>
        <span class="db-stat__label">EC2 Instances</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/rds']" [attr.aria-label]="'RDS Instances: ' + resourceCounts.rds">
        <span class="db-stat__value">{{ resourceCounts.rds }}</span>
        <span class="db-stat__label">RDS Instances</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/s3']" [attr.aria-label]="'S3 Buckets: ' + resourceCounts.s3">
        <span class="db-stat__value">{{ resourceCounts.s3 }}</span>
        <span class="db-stat__label">S3 Buckets</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/ebs']" [attr.aria-label]="'EBS Volumes: ' + resourceCounts.ebs">
        <span class="db-stat__value">{{ resourceCounts.ebs }}</span>
        <span class="db-stat__label">EBS Volumes</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/ebs-snapshots']" [attr.aria-label]="'EBS Snapshots: ' + resourceCounts.ebsSnapshots">
        <span class="db-stat__value">{{ resourceCounts.ebsSnapshots }}</span>
        <span class="db-stat__label">EBS Snapshots</span>
      </a>

      <a class="db-stat" [routerLink]="['/resources/ami-snapshots']" [attr.aria-label]="'AMI Snapshots: ' + resourceCounts.amiSnapshots">
        <span class="db-stat__value">{{ resourceCounts.amiSnapshots }}</span>
        <span class="db-stat__label">AMI Snapshots</span>
      </a>
    </section>

    <!-- 2) Resource Health (componente padronizado) -->
    <section class="db-section">
      <app-resource-health></app-resource-health>
    </section>

    <!-- 3) Monitoring / Status -->
    <section class="db-section">
      <div class="db-monitoring">
        <div class="db-monitoring__block">
          <h3 class="db-h3">Resource Monitoring (CloudWatch)</h3>
          <div class="db-monitoring__grid">
            <app-monitoring-widget
              title="RAM Monitoring"
              [percentage]="monitoringStatus.ramMonitoredPercentage"
              label="Active Monitoring on Resources"
              color="#4fd1c5">
            </app-monitoring-widget>

            <app-monitoring-widget
              title="Disk Monitoring"
              [percentage]="monitoringStatus.diskMonitoredPercentage"
              label="Active Monitoring on Resources"
              color="#9f7aea">
            </app-monitoring-widget>
          </div>
        </div>

        <div class="db-monitoring__block">
          <h3 class="db-h3">Instance Status</h3>
          <app-instance-status-widget
            [total]="instanceStatus.total"
            [running]="instanceStatus.running"
            [stopped]="instanceStatus.stopped"
            [pending]="instanceStatus.pending"
            [terminated]="instanceStatus.terminated">
          </app-instance-status-widget>
        </div>

        <div class="db-monitoring__block">
          <h3 class="db-h3">SSM Agent Status</h3>
          <app-monitoring-widget
            title="SSM Agent"
            [percentage]="ssmStatus.connectedPercentage"
            label="Instances with SSM Agent Connected"
            color="#68d391">
          </app-monitoring-widget>
        </div>
      </div>
    </section>

    <!-- 4) Widgets (DistribuiÃ§Ã£o / Recentes) -->
    <section class="db-widgets">

      <!-- DistribuiÃ§Ã£o por Account -->
      <div class="db-widget">
        <div class="db-widget__head">
          <h3 class="db-h3">Resources by Account</h3>
        </div>
        <div class="db-widget__body">
          <div *ngIf="accountDistribution.length > 0; else noAccountData" class="db-bars">
            <div *ngFor="let item of accountDistribution" class="db-bar" [attr.aria-label]="item.account + ': ' + item.count">
              <div class="db-bar__label" [title]="item.account">{{ item.account }}</div>
              <div class="db-bar__track">
                <div class="db-bar__fill" [style.width.%]="getBarWidth(item.count, accountMaxCount)">
                  <span class="db-bar__value">{{ item.count }}</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noAccountData>
            <div class="ov-empty">No account distribution data available</div>
          </ng-template>
        </div>
      </div>

      <!-- DistribuiÃ§Ã£o por Region -->
      <div class="db-widget">
        <div class="db-widget__head">
          <h3 class="db-h3">Resources by Region</h3>
        </div>
        <div class="db-widget__body">
          <div *ngIf="regionDistribution.length > 0; else noRegionData" class="db-bars">
            <div *ngFor="let item of regionDistribution" class="db-bar" [attr.aria-label]="item.region + ': ' + item.count">
              <div class="db-bar__label" [title]="item.region">{{ item.region }}</div>
              <div class="db-bar__track">
                <div class="db-bar__fill" [style.width.%]="getBarWidth(item.count, regionMaxCount)">
                  <span class="db-bar__value">{{ item.count }}</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noRegionData>
            <div class="ov-empty">No region distribution data available</div>
          </ng-template>
        </div>
      </div>

      <!-- Recent Resources -->
      <div class="db-widget">
        <div class="db-widget__head">
          <h3 class="db-h3">Recent Resources</h3>
          <a class="ov-btn ov-btn--subtle" [routerLink]="['/resources']">View All</a>
        </div>
        <div class="db-widget__body">
          <div *ngIf="recentResources.length > 0; else noRecentData">
            <!-- Desktop: tabela -->
            <section class="ov-tablewrap db-hide-mobile">
              <table class="ov-table" role="table" aria-label="Recent resources">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Region</th>
                    <th>Identifier</th>
                    <th>Last Updated</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let resource of recentResources; trackBy: trackByResourceId" 
                      [routerLink]="['/resources']" 
                      class="db-rowlink"
                      [attr.aria-label]="'View ' + resource.resourceType + ' details'">
                    <td>
                      <span class="resource-type-badge">{{ resource.resourceType }}</span>
                    </td>
                    <td>{{ resource.region || 'Unknown' }}</td>
                    <td>
                      <span class="resource-identifier" [title]="getResourceIdentifier(resource)">
                        {{ getResourceIdentifier(resource) }}
                      </span>
                    </td>
                    <td>
                      <time [dateTime]="resource.lastUpdated">
                        {{ resource.lastUpdated | date: 'short' }}
                      </time>
                    </td>
                  </tr>
                </tbody>
              </table>
            </section>

            <!-- Mobile: cards -->
            <div class="ov-cards db-show-mobile">
              <article class="ov-card" 
                       *ngFor="let resource of recentResources; trackBy: trackByResourceId" 
                       [routerLink]="['/resources']" 
                       class="db-rowlink"
                       [attr.aria-label]="'View ' + resource.resourceType + ' details'">
                <header class="ov-card__head">
                  <div>
                    <div class="ov-card__title">{{ resource.resourceType }}</div>
                    <div class="ov-card__sub">{{ getResourceIdentifier(resource) }}</div>
                  </div>
                </header>
                <div class="ov-card__grid">
                  <div>
                    <div class="ov-k">Region</div>
                    <div class="ov-v">{{ resource.region || 'Unknown' }}</div>
                  </div>
                  <div>
                    <div class="ov-k">Last Updated</div>
                    <div class="ov-v">
                      <time [dateTime]="resource.lastUpdated">
                        {{ resource.lastUpdated | date: 'short' }}
                      </time>
                    </div>
                  </div>
                </div>
              </article>
            </div>
          </div>

          <ng-template #noRecentData>
            <div class="ov-empty">
              <div class="ov-empty__icon">ðŸ“„</div>
              <p class="ov-empty__text">No recent resources found</p>
              <p class="ov-empty__sub">Resources will appear here as they are created or updated</p>
            </div>
          </ng-template>
        </div>
      </div>

    </section>
  </div>
</article>