<!-- src/app/features/dashboard/dashboard.component.html -->
<div class="ov-dashboard">
  <!-- Header -->
  <div class="ov-dashboard-header">
    <div class="ov-header-title">
      <h1>Dashboard</h1>
      <span class="ov-last-update" *ngIf="!loading">
        Last updated: {{ getCurrentTime() }}
      </span>
    </div>
    <div class="ov-header-actions">
      <button (click)="refreshData()" class="ov-btn ov-btn-icon" [disabled]="loading">
        <span class="ov-icon">‚Üª</span>
        <span>Refresh</span>
      </button>
      <button (click)="onTriggerCollector()" class="ov-btn ov-btn-primary" [disabled]="loading">
        <span class="ov-icon">‚ö°</span>
        <span>Trigger Collector</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="ov-loading-container">
    <div class="ov-spinner"></div>
    <p>Loading metrics...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="ov-error-container">
    <div class="ov-error-icon">‚ö†Ô∏è</div>
    <h3>Error Loading Metrics</h3>
    <p>{{ error }}</p>
    <button (click)="refreshData()" class="ov-btn ov-btn-primary">Retry</button>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!loading && !error && currentMetrics?.length" class="ov-dashboard-content">
    
    <!-- Top Metrics Cards -->
    <div class="ov-metrics-cards">
      <!-- Total Resources Card -->
      <div class="ov-metric-card" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.totalResources)">
          <div class="ov-card-value">{{ formatNumber(metric.totalResources) }}</div>
          <div class="ov-card-label">Total Resources</div>
        </div>
      </div>

      <!-- EC2 Instances -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/ec2" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.resourceCounts_EC2Instance)">
          <div class="ov-card-value">{{ formatNumber(metric.resourceCounts_EC2Instance) }}</div>
          <div class="ov-card-label">EC2 Instances</div>
        </div>
      </a>

      <!-- RDS Instances -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/rds" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.resourceCounts_RDSInstance)">
          <div class="ov-card-value">{{ formatNumber(metric.resourceCounts_RDSInstance) }}</div>
          <div class="ov-card-label">RDS Instances</div>
        </div>
      </a>

      <!-- S3 Buckets -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/s3" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.resourceCounts_S3Bucket)">
          <div class="ov-card-value">{{ formatNumber(metric.resourceCounts_S3Bucket) }}</div>
          <div class="ov-card-label">S3 Buckets</div>
        </div>
      </a>

      <!-- EBS Volumes -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/ebs" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.resourceCounts_EBSVolume)">
          <div class="ov-card-value">{{ formatNumber(metric.resourceCounts_EBSVolume) }}</div>
          <div class="ov-card-label">EBS Volumes</div>
        </div>
      </a>

      <!-- EBS Snapshots -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/ebs-snapshots" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.ebsSnapshots || metric.resourceCounts_EBSSnapshot)">
          <div class="ov-card-value">{{ formatNumber(metric.ebsSnapshots || metric.resourceCounts_EBSSnapshot) }}</div>
          <div class="ov-card-label">EBS Snapshots</div>
        </div>
      </a>

      <!-- AMI Snapshots -->
      <a class="ov-metric-card ov-card-clickable" routerLink="/ami-snapshots" *ngFor="let metric of currentMetrics">
        <div class="ov-card-mini" *ngIf="hasValue(metric.amiSnapshots)">
          <div class="ov-card-value">{{ formatNumber(metric.amiSnapshots) }}</div>
          <div class="ov-card-label">AMI Snapshots</div>
        </div>
      </a>
    </div>

    <!-- Resource Health Section -->
    <div class="ov-section" *ngFor="let metric of currentMetrics">
      <h2 class="ov-section-title">Resource Health</h2>
      
      <div class="ov-health-grid">
        <!-- EC2 Instances Health -->
        <div class="ov-health-card" *ngIf="hasValue(metric.byState_running) || hasValue(metric.byState_stopped)">
          <div class="ov-health-header">
            <span class="ov-health-title">EC2 Instances</span>
            <span class="ov-health-badge">{{ metric.resourceCounts_EC2Instance || 0 }}</span>
          </div>
          <div class="ov-progress-container">
            <div class="ov-progress-bar">
              <div class="ov-progress-fill ov-progress-green" 
                   [style.width.%]="getHealthPercentage(metric.byState_running, metric.resourceCounts_EC2Instance)">
              </div>
              <div class="ov-progress-fill ov-progress-yellow" 
                   [style.width.%]="getHealthPercentage(metric.byState_stopped, metric.resourceCounts_EC2Instance)"
                   [style.left.%]="getHealthPercentage(metric.byState_running, metric.resourceCounts_EC2Instance)">
              </div>
            </div>
            <div class="ov-progress-values">
              <span class="ov-value-left">{{ metric.byState_running || 0 }}</span>
              <span class="ov-value-right">{{ metric.byState_stopped || 0 }}</span>
            </div>
          </div>
          <div class="ov-health-status" [ngClass]="getHealthStatusClass(metric.byState_running, metric.resourceCounts_EC2Instance)">
            {{ getHealthPercentage(metric.byState_running, metric.resourceCounts_EC2Instance) }}% Healthy
            <span class="ov-status-detail">({{ metric.byState_stopped || 0 }} stopped)</span>
          </div>
          <div class="ov-health-meta">
            <span>System: {{ formatValue(metric.instanceId) }}</span>
            <span>Instance: {{ formatValue(metric.instanceId) }}</span>
            <span>EBS: {{ formatValue(metric.ebsStatus) }}</span>
          </div>
        </div>

        <!-- RDS Instances Health -->
        <div class="ov-health-card" *ngIf="hasValue(metric.total) && metric.id?.includes('RDS')">
          <div class="ov-health-header">
            <span class="ov-health-title">RDS Instances</span>
            <span class="ov-health-badge">{{ metric.total || 0 }}</span>
          </div>
          <div class="ov-progress-container">
            <div class="ov-progress-bar">
              <div class="ov-progress-fill ov-progress-green" 
                   [style.width.%]="getHealthPercentage(metric.available, metric.total)">
              </div>
            </div>
            <div class="ov-progress-values">
              <span class="ov-value-left">{{ metric.available || 0 }}</span>
            </div>
          </div>
          <div class="ov-health-status ov-status-healthy">
            100% Healthy
          </div>
        </div>

        <!-- EBS Volumes Health -->
        <div class="ov-health-card" *ngIf="hasValue(metric.ebsVolumes)">
          <div class="ov-health-header">
            <span class="ov-health-title">EBS Volumes</span>
            <span class="ov-health-badge">{{ metric.ebsVolumes || metric.resourceCounts_EBSVolume || 0 }}</span>
          </div>
          <div class="ov-progress-container">
            <div class="ov-progress-bar">
              <div class="ov-progress-fill ov-progress-green" [style.width.%]="100"></div>
            </div>
            <div class="ov-progress-values">
              <span class="ov-value-left">{{ metric.ebsVolumes || metric.resourceCounts_EBSVolume || 0 }}</span>
            </div>
          </div>
          <div class="ov-health-status ov-status-healthy">
            100% Healthy
          </div>
        </div>

        <!-- S3 Buckets Health -->
        <div class="ov-health-card" *ngIf="hasValue(metric.s3Buckets || metric.resourceCounts_S3Bucket)">
          <div class="ov-health-header">
            <span class="ov-health-title">S3 Buckets</span>
            <span class="ov-health-badge">{{ metric.s3Buckets || metric.resourceCounts_S3Bucket || 0 }}</span>
          </div>
          <div class="ov-progress-container">
            <div class="ov-progress-bar">
              <div class="ov-progress-fill ov-progress-green" [style.width.%]="100"></div>
            </div>
            <div class="ov-progress-values">
              <span class="ov-value-left">{{ metric.s3Buckets || metric.resourceCounts_S3Bucket || 0 }}</span>
            </div>
          </div>
          <div class="ov-health-status ov-status-healthy">
            100% Healthy
          </div>
        </div>
      </div>
    </div>

    <!-- Monitoring Grid -->
    <div class="ov-monitoring-grid" *ngFor="let metric of currentMetrics">
      
      <!-- Resource Monitoring (CloudWatch) -->
      <div class="ov-monitoring-card">
        <h3>Resource Monitoring (CloudWatch)</h3>
        
        <!-- RAM Monitoring -->
        <div class="ov-monitor-item" *ngIf="hasValue(metric.cloudwatchAgent_memoryMonitoring)">
          <div class="ov-monitor-label">RAM Monitoring</div>
          <div class="ov-monitor-bar">
            <div class="ov-monitor-progress" 
                 [style.width.%]="metric.cloudwatchAgent_percentageWithMemory || 83">
            </div>
          </div>
          <div class="ov-monitor-value">
            {{ metric.cloudwatchAgent_percentageWithMemory || 83 }}% 
            <span>Active Monitoring on Resources</span>
          </div>
        </div>

        <!-- Disk Monitoring -->
        <div class="ov-monitor-item" *ngIf="hasValue(metric.cloudwatchAgent_diskMonitoring)">
          <div class="ov-monitor-label">Disk Monitoring</div>
          <div class="ov-monitor-bar">
            <div class="ov-monitor-progress ov-monitor-purple" 
                 [style.width.%]="metric.cloudwatchAgent_percentageWithDisk || 83">
            </div>
          </div>
          <div class="ov-monitor-value">
            {{ metric.cloudwatchAgent_percentageWithDisk || 83 }}% 
            <span>Active Monitoring on Resources</span>
          </div>
        </div>
      </div>

      <!-- Instance Status -->
      <div class="ov-monitoring-card">
        <h3>Instance Status</h3>
        <div class="ov-status-header">
          <span>EC2 Status</span>
          <span class="ov-status-indicator">{{ getRunningPercentage(metric) }}% RUNNING</span>
        </div>
        <div class="ov-status-subtitle">Overview of instance states</div>
        
        <div class="ov-status-stats">
          <div class="ov-stat-item">
            <div class="ov-stat-label">TOTAL</div>
            <div class="ov-stat-value">{{ metric.resourceCounts_EC2Instance || 0 }}</div>
          </div>
          <div class="ov-stat-item">
            <div class="ov-stat-label">RUNNING</div>
            <div class="ov-stat-value ov-text-green">{{ metric.byState_running || 0 }}</div>
          </div>
          <div class="ov-stat-item">
            <div class="ov-stat-label">STOPPED</div>
            <div class="ov-stat-value ov-text-gray">{{ metric.byState_stopped || 0 }}</div>
          </div>
        </div>
      </div>

      <!-- SSM Agent Status -->
      <div class="ov-monitoring-card">
        <h3>SSM Agent Status</h3>
        <div class="ov-agent-header">
          <span>SSM Agent</span>
        </div>
        
        <div class="ov-agent-bar">
          <div class="ov-agent-progress" 
               [style.width.%]="metric.ssmAgent_percentageConnected || 92">
          </div>
        </div>
        <div class="ov-agent-value">
          {{ metric.ssmAgent_percentageConnected || 92 }}% 
          <span>Instances with SSM Agent Connected</span>
        </div>
      </div>
    </div>

    <!-- Resources by Account & Region -->
    <div class="ov-distribution-grid" *ngFor="let metric of currentMetrics">
      
      <!-- Resources by Account -->
      <div class="ov-distribution-card" *ngIf="metric.accountDistribution">
        <h3>Resources by Account</h3>
        <div class="ov-distribution-list">
          <div class="ov-dist-item" *ngFor="let account of getAccountDistribution(metric)">
            <div class="ov-dist-label">{{ account.name }}</div>
            <div class="ov-dist-bar-container">
              <div class="ov-dist-bar" [style.width.%]="account.percentage"></div>
            </div>
            <div class="ov-dist-value">{{ account.value }}</div>
          </div>
        </div>
      </div>

      <!-- Resources by Region -->
      <div class="ov-distribution-card" *ngIf="metric.regionDistribution">
        <h3>Resources by Region</h3>
        <div class="ov-distribution-list">
          <div class="ov-dist-item" *ngFor="let region of getRegionDistribution(metric)">
            <div class="ov-dist-label">{{ region.name }}</div>
            <div class="ov-dist-bar-container">
              <div class="ov-dist-bar" [style.width.%]="region.percentage"></div>
            </div>
            <div class="ov-dist-value">{{ region.value }}</div>
          </div>
        </div>
      </div>

      <!-- Recent Resources -->
      <div class="ov-distribution-card">
        <h3>Recent Resources</h3>
        <a class="ov-view-all" routerLink="/resources">View All</a>
        
        <div class="ov-empty-resources" *ngIf="!metric.recentResources || getRecentResources(metric).length === 0">
          <div class="ov-empty-icon">üìÅ</div>
          <p>No recent resources found</p>
          <span>Resources will appear here as they are created or updated</span>
        </div>
        
        <div class="ov-recent-list" *ngIf="getRecentResources(metric).length > 0">
          <div class="ov-recent-item" *ngFor="let resource of getRecentResources(metric)">
            <span class="ov-recent-type">{{ resource.type }}</span>
            <span class="ov-recent-name">{{ resource.name }}</span>
            <span class="ov-recent-time">{{ resource.time }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && (!currentMetrics || currentMetrics.length === 0)" class="ov-empty-state">
    <div class="ov-empty-icon">üìä</div>
    <h3>No metrics available</h3>
    <p>Click "Trigger Collector" to start collecting AWS metrics.</p>
    <button (click)="onTriggerCollector()" class="ov-btn ov-btn-primary">
      <span class="ov-icon">‚ö°</span>
      Trigger Collector
    </button>
  </div>
</div>